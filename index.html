<html>
    <title>Video.js with MPEG-DASH playback support through videojs-contrib-dash with Streamroot P2P</title>
    <head>

        <!-- dash.js -->
        <script src="http://dashif.org/reference/players/javascript/v2.1.1/dist/dash.all.debug.js"></script>

        <!-- video.js -->
        <link href="//vjs.zencdn.net/5.8/video-js.min.css" rel="stylesheet">
        <script src="//vjs.zencdn.net/5.8/video.min.js"></script>

        <!-- videojs-contrib-dash script -->
        <script src="dist/videojs-dash.js"></script>

        <!-- p2p graphics and peer stats -->
        <script src="http://cdn.streamroot.io/2/scripts/p2pGraph.js"></script>
        <script src="http://cdn.streamroot.io/2/scripts/peerStat.js"></script>
        <!-- graphics dependencies -->
        <script src="http://cdnjs.cloudflare.com/ajax/libs/rickshaw/1.4.6/rickshaw.min.js"> </script>
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/rickshaw/1.4.6/rickshaw.min.css">
        <script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.9/d3.min.js"> </script>

    </head>
    <body>
        <div id="mainfestSelection" />
            <select id="mpdSelector" name="mpdSelector">
                <option value="http://wowza.streamroot.io/vodOriginSite/tears_of_steel720p.mp4/manifest.mpd">ToS (VoD, 1 video)</option>
                <option value="http://wowza.streamroot.io/liveorigin/stream4/manifest.mpd">ToS (Live DVR, 1 video)</option>
                <option value="http://wowza.streamroot.io/liveorigin/Sample-live.smil/manifest.mpd">Sintel (Live DVR, 3 video)</option>
                <option value="http://wowza.streamroot.io/vodOriginSite/Sample-vod.smil/manifest.mpd">Sintel (VoD, 3 video)</option>
            </select>
        </div>
        <div>
            <video id="video_element" width="480" height="360" controls muted class="video-js vjs-default-skin" />
        </div>

        <script>
            (function() {
                function onMPDSelected(event) {
                    var mpdUrl = document.getElementById("mpdSelector").value;
                    window.location = window.location.origin + window.location.pathname + "?mpd=" + encodeURIComponent(mpdUrl);
                }

                function getURLParams(url) {
                    if (!url) {
                        return {};
                    }

                    var search = url.substring(1); //removing '?'
                    var paramValueList = search.split("&");
                    var params = {};
                    paramValueList.forEach(function(entry){
                        var paramValue = entry.split("=");
                        if (entry) {
                            params[paramValue[0]] = decodeURIComponent(paramValue[1]);
                        }
                    });

                    return params;
                }

                var mpdSelector = document.getElementById("mpdSelector");
                mpdSelector.onchange = onMPDSelected;

                var url = getURLParams(document.location.search)["mpd"] || mpdSelector.value;
                mpdSelector.value = url;

                var options = {
                    html5: {
                        streamroot: {
                            p2pConfig: {
                                streamrootKey: "a913c6b8-5037-4ed8-9c94-918f70c40320",
                                debug: true
                            }
                        }
                    }
                };

                var player = videojs('video_element', options);
                player.src(url);
            })();
        </script>
    </body>
</html>
